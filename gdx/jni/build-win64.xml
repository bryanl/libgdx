<project name="gdx-natives" basedir="." default="link">
	<!-- include the environment -->
	<property environment="env"/>	
	
	<!-- defined build directory where object files and shared lib will be placed in -->
	<property name="builddir" value="../windows64"/>
	<property name="libname" value="gdx-64.dll"/>
	<property name="jni-platform" value="win32"/>
	
	<!-- define g++ compiler, options and files to compile -->
	<property name="g++" value="x86_64-w64-mingw32-g++"/>
	<property name="g++-opts" value="-c -Wall -O2 -mfpmath=sse -msse2 -DFIXED_POINT -fmessage-length=0"/>
	<fileset id="g++-files" dir="./">
		<include name="**/*.cpp"/>
		<exclude name="Mpg123Decoder.cpp"/>
		<exclude name="mpg123/**"/>
	</fileset>
	
	<!-- define gcc compiler, options and files to compile -->
	<property name="gcc" value="x86_64-w64-mingw32-gcc"/>	
	<property name="gcc-opts" value="${g++-opts}"/>
	<fileset id="gcc-files" dir="./">		
		<include name="**/*.c"/>				
		<exclude name="mpg123/**"/>
	</fileset>

	<!-- define linker and options -->
	<property name="linker" value="x86_64-w64-mingw32-g++"/>
	<property name="linker-opts" value="-Wl,--kill-at -shared"/>
	
	<!-- cleans the build directory, removes all object files and shared libs -->
	<target name="clean">
		<delete includeemptydirs="true">
			<fileset dir="${builddir}" includes="**/*" excludes="**/.svn"/>
		</delete>
	</target>

	<!-- compiles all C and C++ files to object files in the build directory -->
	<target name="compile">
		<apply failonerror="true" executable="${g++}" dest="${builddir}" verbose="true">
			<arg line="${g++-opts}"/>
			<arg value="-I${env.JAVA_HOME}/include"/>
			<arg value="-I${env.JAVA_HOME}/include/${jni-platform}"/>
			<arg value="-I./"/>
			<srcfile/>
			<arg value="-o"/>
			<targetfile/>
			<fileset refid="g++-files"/>
			<chainedmapper>
				<flattenmapper/>
				<mapper type="glob" from="*.cpp" to="*.o"/>
			</chainedmapper>
		</apply>
		<apply failonerror="true" executable="${gcc}" dest="${builddir}" verbose="true">
			<arg line="${gcc-opts}"/>
			<arg value="-I${env.JAVA_HOME}/include"/>
			<arg value="-I${env.JAVA_HOME}/include/${jni-platform}"/>
			<arg value="-I./"/>
			<srcfile/>
			<arg value="-o"/>
			<targetfile/>
			<fileset refid="gcc-files"/>
			<chainedmapper>
				<flattenmapper/>
				<mapper type="glob" from="*.c" to="*.o"/>
			</chainedmapper>
		</apply>
	</target>	

	<!-- links the shared library based on the previously compiled object files -->
	<target name="link" depends="compile">
		<exec executable="${linker}" dir="./">
		<arg line="${linker-opts} -o ${builddir}/${libname} ${builddir}/*.o"/>
		</exec>	
	</target>
</project>