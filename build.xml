<!-- 

 libgdx distribution ant build file. Performs the compilation of the modules
 gdx, gdx-backend-android, gdx-backend-desktop, gdx-backend-applet
 and creates a distribution out of this mess. 

-->
<project name="gdx" default="dist" basedir="." xmlns:cpptasks="antlib:net.sf.antcontrib.cpptasks" >

	<description>libgdx distribution build file</description>
	
	<!-- property for NDK_HOME, you need to set this to
	     the root directory of your Android NDK installation,
		 e.g. c:\android-ndk or /opt/android-ndk -->
	<property environment="env"/>
	<property name="version" value="0.61"/>
	
	<!-- clean output directories -->
	<target name="clean">
		<delete dir="libs"/>
		<delete dir="gdx/bin"/>
		<delete dir="gdx-backend-desktop/bin"/>
		<delete dir="gdx-backend-applet/bin"/>
		<delete dir="gdx-backend-android/bin"/>
	</target>
	
	<!-- init task, creates all necessary directories -->
	<target name="init" depends="clean">
		<mkdir dir="libs/"/>
		<mkdir dir="libs/armeabi"/>
		<mkdir dir="libs/armeabi-v7a"/>
		<mkdir dir="gdx/bin"/>
		<mkdir dir="gdx-backend-applet/bin"/>
		<mkdir dir="gdx-backend-android/bin"/>
		<mkdir dir="gdx-backend-desktop/bin"/>
	</target>
	
	<target name="compile" depends="init,compile-native">
		<!-- build gdx api -->
		<javac srcdir="gdx/src" destdir="gdx/bin"/>
		
		<!-- build desktop backend -->
		<javac srcdir="gdx-backend-desktop/src" destdir="gdx-backend-desktop/bin">
			<classpath>
				<pathelement location="gdx/bin"/>
				<pathelement location="gdx-backend-desktop/libs/gdx-dependencies-desktop.jar"/>
			</classpath>
		</javac>
		
		<!-- build android backend -->
		<javac srcdir="gdx-backend-android/src" destdir="gdx-backend-android/bin">
			<classpath>
				<pathelement location="gdx/bin"/>
				<pathelement location="gdx-backend-android/libs/android-2.0.jar"/>
			</classpath>
		</javac>
		
		<!-- build applet backend -->
		<javac srcdir="gdx-backend-applet/src" destdir="gdx-backend-applet/bin">
			<classpath>
				<pathElement location="gdx/bin"/>
				<pathElement location="gdx-backend-applet/libs/gdx-dependencies-applet.jar"/>
			</classpath>
		</javac>
	</target>
	
	<target name="compile-native" depends="init">
		<exec executable="make" dir="gdx">
			<arg value="-f"/>
			<arg value="${env.NDK_HOME}/build/core/build-local.mk"/>
		</exec>
	</target>
	
	<target name="dist">
		<jar destfile="libs/gdx-${version}.jar" basedir="gdx/bin"/>
		<jar destfile="libs/gdx-${version}-sources.jar" basedir="gdx/bin"/>
		<jar destfile="libs/gdx-backend-desktop.jar" basedir="gdx-backend-desktop/bin"/>
		<jar destfile="libs/gdx-backend-android.jar" basedir="gdx-backend-android/bin"/>
		<jar destfile="libs/gdx-backend-applet.jar" basedir="gdx-backend-applet/bin"/>
		<copy tofile="libs/armeabi/libgdx-${version}.so" file="gdx/libs/armeabi/libgdx.so"/>
		<copy tofile="libs/armeabi/libandroidgl20.so" file="gdx/libs/armeabi/libandroidgl20.so"/>
		<copy tofile="libs/armeabi-v7a/libgdx-${version}.so" file="gdx/libs/armeabi-v7a/libgdx.so"/>		
		<copy tofile="libs/gdx-dependencies-desktop.jar" file="gdx-backend-desktop/libs/gdx-dependencies-desktop.jar"/>
		<copy tofile="libs/gdx-dependencies-applet.jar" file="gdx-backend-applet/libs/gdx-dependencies-applet.jar"/>		
		<copy tofile="libs/README" file="gdx/dist/README"/>
		<copy tofile="libs/LICENSE-2.0.html" file="gdx/dist/LICENSE-2.0.html"/>
	</target>
</project>