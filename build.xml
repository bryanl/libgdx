<!-- 

 libgdx distribution ant build file. Performs the compilation of the modules
 gdx, gdx-backend-android, gdx-backend-jogl, gdx-backend-lwjgl
 and creates a distribution out of this mess. 

-->
<project name="gdx" default="dist" basedir="." >

	<description>libgdx distribution build file</description>
	
	<!-- property for NDK_HOME, you need to set this to
	     the root directory of your Android NDK installation,
		 e.g. c:\android-ndk or /opt/android-ndk -->
	<!--<property environment="env"/>-->
	
	<property name="env.NDK_HOME" value="/opt/android-ndk-r4b"/>
	
	<!-- output directory for distribution -->
	<property name="stable" value="target"/>
	
	<!-- clean output directories -->
	<target name="clean">
		<delete dir="${stable}"/>
		<delete dir="gdx/bin"/>
		<delete dir="backends/gdx-backend-jogl/bin"/>		
		<delete dir="backends/gdx-backend-lwjgl/bin"/>		
		<delete dir="backends/gdx-backend-android/bin"/>
		<delete dir="extensions/twl/gdx-twl/bin"/>
	</target>
	
	<!-- init task, creates all necessary directories -->
	<target name="init" depends="clean">
		<mkdir dir="${stable}"/>
		<mkdir dir="${stable}/docs/api"/>
		<mkdir dir="gdx/bin"/>		
		<mkdir dir="backends/gdx-backend-android/bin"/>
		<mkdir dir="backends/gdx-backend-jogl/bin"/>
		<mkdir dir="backends/gdx-backend-lwjgl/bin"/>
		<mkdir dir="extensions/twl/gdx-twl/bin"/>
	</target>
	
	<!-- compiles the java code of all modules -->
	<target name="compile" depends="init">
		<!-- build gdx api -->
		<javac srcdir="gdx/src" destdir="gdx/bin"/>
		<copy tofile="gdx/bin/com/badlogic/gdx/utils/arial-15.png" file="gdx/src/com/badlogic/gdx/utils/arial-15.png"/>
		<copy tofile="gdx/bin/com/badlogic/gdx/utils/arial-15.fnt" file="gdx/src/com/badlogic/gdx/utils/arial-15.fnt"/>
		
		<!-- build jogl backend -->
		<javac srcdir="backends/gdx-backend-jogl/src" destdir="backends/gdx-backend-jogl/bin">
			<classpath>
				<pathelement location="gdx/bin"/>
				<pathelement location="backends/dependencies/gluegen-rt.jar"/>
				<pathelement location="backends/dependencies/javazoom-spi.jar"/>
				<pathelement location="backends/dependencies/jl1.0.1.jar"/>
				<pathelement location="backends/dependencies/jogl-natives.jar"/>
				<pathelement location="backends/dependencies/jogl.jar"/>
				<pathelement location="backends/dependencies/jorbis.jar"/>
				<pathelement location="backends/dependencies/tritonus-utils.jar"/>				
			</classpath>
		</javac>
		
		<!-- build lwjgl backend -->
		<javac srcdir="backends/gdx-backend-lwjgl/src" destdir="backends/gdx-backend-lwjgl/bin">
			<classpath>
				<pathelement location="gdx/bin"/>
				<pathelement location="backends/dependencies/lwjgl.jar"/>
				<pathelement location="backends/dependencies/javazoom-spi.jar"/>
				<pathelement location="backends/dependencies/jl1.0.1.jar"/>
				<pathelement location="backends/dependencies/jorbis.jar"/>
				<pathelement location="backends/dependencies/tritonus-utils.jar"/>
			</classpath>
		</javac>
		
		<!-- build android backend -->
		<javac srcdir="backends/gdx-backend-android/src" destdir="backends/gdx-backend-android/bin">
			<classpath>
				<pathelement location="gdx/bin"/>
				<pathelement location="backends/dependencies/android-2.0.jar"/>
			</classpath>
		</javac>		
		
		<!-- build twl extensions -->
		<javac srcdir="extensions/twl/gdx-twl/src" destdir="extensions/twl/gdx-twl/bin">
			<classpath>
				<pathelement location="gdx/bin" />
				<pathelement location="extensions/twl/gdx-twl/libs/twl-android.jar" />
				<pathelement location="extensions/twl/gdx-twl/libs/xpp3-1.1.4c.jar" />
			</classpath>
		</javac>
	</target>

	<!-- compiles the native code (for android only atm) -->
	<target name="compile-native" depends="init">
		<exec executable="make" dir="gdx">
			<arg value="-f"/>			
			<arg value="${env.NDK_HOME}/build/core/build-local.mk"/>
			<arg value="clean"/>
		</exec>
		<exec executable="make" dir="gdx">
			<arg value="-f"/>			
			<arg value="${env.NDK_HOME}/build/core/build-local.mk"/>
		</exec>
	</target>
	
	<!-- generates the javadoc for the core api and the application implementations -->
	<target name="docs" depends="init">
		<javadoc destdir="${stable}/docs/api" author="true" version="true" use="true" windowtitle="Test API">
			<fileset dir="gdx/src" defaultexcludes="yes">
				<include name="com/badlogic/gdx/**" />
				<exclude name="com/badlogic/gdx/utils/arial-15.fnt" />
				<exclude name="com/badlogic/gdx/utils/arial-15.png" />
			</fileset>
			<fileset dir="backends" includes="gdx-backend-jogl/src/com/badlogic/gdx/backends/jogl/JoglApplication.java"/>
			<fileset dir="backends" includes="gdx-backend-lwjgl/src/com/badlogic/gdx/backends/lwjgl/LwjglApplication.java"/>
			<fileset dir="backends" includes="gdx-backend-lwjgl/src/com/badlogic/gdx/backends/lwjgl/LwjglCanvas.java"/>
			<fileset dir="backends" includes="gdx-backend-lwjgl/src/com/badlogic/gdx/backends/lwjgl/LwjglApplet.java"/>
			<fileset dir="backends" includes="gdx-backend-android/src/com/badlogic/gdx/backends/android/AndroidApplication.java"/>
			<fileset dir="extensions/twl/" includes="gdx-twl/src/com/badlogic/gdx/twl/TWL.java"/>
		</javadoc>
	</target>
	
	<!-- builds the distribution directory, does not include the desktop libs 
		for some reason excludes don't work so i have to delete the ndk directory first... -->
	<target name="dist" depends="compile,compile-native,docs">
		<delete dir="gdx/bin/ndk"/>
		<jar destfile="${stable}/gdx.jar" basedir="gdx/bin"/>
		<jar destfile="${stable}/gdx-sources.jar" basedir="gdx/src"/>
		<jar destfile="${stable}/gdx-backend-jogl.jar">
			<fileset dir="backends/gdx-backend-jogl/bin"/>
			<zipfileset src="backends/dependencies/gluegen-rt.jar"/>
			<zipfileset src="backends/dependencies/javazoom-spi.jar"/>
			<zipfileset src="backends/dependencies/jl1.0.1.jar"/>
			<zipfileset src="backends/dependencies/jogl-natives.jar"/>
			<zipfileset src="backends/dependencies/jogl.jar"/>
			<zipfileset src="backends/dependencies/jorbis.jar"/>
			<zipfileset src="backends/dependencies/tritonus-utils.jar"/>
		</jar>
		<jar destfile="${stable}/gdx-backend-lwjgl.jar">
			<fileset dir="backends/gdx-backend-lwjgl/bin"/>
			<zipfileset src="backends/dependencies/lwjgl.jar"/>
			<zipfileset src="backends/dependencies/javazoom-spi.jar"/>
			<zipfileset src="backends/dependencies/jl1.0.1.jar"/>
			<zipfileset src="backends/dependencies/jorbis.jar"/>
			<zipfileset src="backends/dependencies/tritonus-utils.jar"/>
		</jar>
		<jar destfile="${stable}/gdx-backend-android.jar" basedir="backends/gdx-backend-android/bin"/>
		<jar destfile="${stable}/gdx-twl.jar">
			<fileset dir="extensions/twl/gdx-twl/bin" />
			<zipfileset src="extensions/twl/gdx-twl/libs/twl-android.jar" />
			<zipfileset src="extensions/twl/gdx-twl/libs/xpp3-1.1.4c.jar" />
		</jar>
		
		<copy tofile="${stable}/gdx.dll" file="gdx/windows/gdx.dll" failonerror="false"/>
		<copy tofile="${stable}/libgdx.so" file="gdx/linux/libgdx.so" failonerror="false"/>
		<copy tofile="${stable}/libgdx-64.so" file="gdx/linux64/libgdx-64.so" failonerror="false"/>		
		<copy tofile="${stable}/armeabi/libgdx.so" file="gdx/libs/armeabi/libgdx.so"/>
		<copy tofile="${stable}/armeabi/libandroidgl20.so" file="gdx/dist/armeabi/libandroidgl20.so"/>
		<copy tofile="${stable}/armeabi-v7a/libgdx.so" file="gdx/libs/armeabi-v7a/libgdx.so"/>				
		<copy tofile="${stable}/README" file="gdx/dist/README"/>
		<copy tofile="${stable}/LICENSE-2.0.html" file="gdx/dist/LICENSE-2.0.html"/>
		<zip destfile="libgdx-nightly.zip" basedir="${stable}"/>
	</target>	
</project>
